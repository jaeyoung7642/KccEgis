<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="TeamRankMapper">
<select id="teamRankHome" resultType="map">
		select top 1 season_code,game_code,rank,team_code,
		game_count,t_win,t_loss,conti_win,conti_loss,format(win_rate, '##0.##') win_rate,win_diff 
		from 
		KCC_EGIS.kbl_data.team_daily_rank
		where
		team_code = '60'
		and game_date = (select MAX(game_date) from KCC_EGIS.kbl_data.team_daily_rank where game_code = '01')  
		and season_code ='45'
	</select>
<select id="getTeamRank" resultType="map">
		select season_code,game_code,rank,team_code,
		game_count,t_win,t_loss,conti_win,conti_loss,format(win_rate, '##0.##') win_rate,win_diff 
		,wl_three
		from 
		KCC_EGIS.kbl_data.team_daily_rank
		where 1=1
		and team_code = #{team_code}
		and season_code = #{season_code}
		and game_date = (select MAX(game_date) from KCC_EGIS.kbl_data.team_daily_rank where season_code=#{season_code} and game_code='01')
	</select>
<select id="teamRankList" resultType="map">
		select A.*,B.team_name_1 
		from 
		(SELECT 
		    t1.season_code, t1.game_code, t1.rank, t1.team_code,
		    t1.game_count, t1.t_win, t1.t_loss, t1.conti_win, t1.conti_loss,
		    FORMAT(t1.win_rate, '##0.##') AS win_rate, t1.win_diff, t1.wl_three , max_conti_win , max_conti_loss
		FROM 
		    KCC_EGIS.kbl_data.team_daily_rank t1
		JOIN (
		    SELECT 
		        team_code, MAX(conti_win) AS max_conti_win , MAX(conti_loss) AS max_conti_loss
		    FROM 
		        KCC_EGIS.kbl_data.team_daily_rank
		    WHERE 
		        season_code = #{season_code}
		        and game_code = '01'
		    GROUP BY 
		        team_code
		) t2 ON t1.team_code = t2.team_code
		WHERE 
		    t1.season_code = #{season_code}
		    AND t1.game_date = (
		        SELECT MAX(game_date) 
		        FROM KCC_EGIS.kbl_data.team_daily_rank 
		        WHERE season_code = #{season_code}
		        and game_code = '01'
		    ) )A ,KCC_EGIS.kbl_data.code_team B
		    where A.season_code = B.season_code
				and A.team_code = B.team_code
				and A.game_code = '01'
				order by A.rank
	</select>
<select id="teamCategoryRankList" resultType="map">
		SELECT *
			FROM (
			    SELECT *, ROW_NUMBER() OVER (ORDER BY A.category_data DESC) AS rn
			    FROM (
			        SELECT a.*,a.score as category_data,'득점' as cate
			        FROM KCC_EGIS.kbl_data.team_sum a
			        WHERE a.quarter_gu = 'XX'
			          AND a.season_code = #{season_code}
			          AND a.game_count != 0
			          AND a.game_code = '01'
			    ) AS A
			) AS C
			WHERE team_code = '60'
			UNION ALL
			SELECT *
			FROM (
			    SELECT *, ROW_NUMBER() OVER (ORDER BY A.category_data DESC) AS rn
			    FROM (
			        SELECT a.*,(o_r+d_r) as category_data,'리바운드' as cate
			        FROM KCC_EGIS.kbl_data.team_sum a
			        WHERE a.quarter_gu = 'XX'
			          AND a.season_code = #{season_code}
			          AND a.game_count != 0
			          AND a.game_code = '01'
			    ) AS A
			) AS C
			WHERE team_code = '60'
			UNION ALL
			SELECT *
			FROM (
			    SELECT *, ROW_NUMBER() OVER (ORDER BY A.category_data DESC) AS rn
			    FROM (
			        SELECT a.*, a_s as category_data,'어시스트' as cate
			        FROM KCC_EGIS.kbl_data.team_sum a
			        WHERE a.quarter_gu = 'XX'
			          AND a.season_code = #{season_code}
			          AND a.game_count != 0
			          AND a.game_code = '01'
			    ) AS A
			) AS C
			WHERE team_code = '60'
			UNION ALL
			SELECT *
			FROM (
			    SELECT *, ROW_NUMBER() OVER (ORDER BY A.category_data DESC) AS rn
			    FROM (
			        SELECT a.*,a.s_t as category_data,'스틸' as cate
			        FROM KCC_EGIS.kbl_data.team_sum a
			        WHERE a.quarter_gu = 'XX'
			          AND a.season_code = #{season_code}
			          AND a.game_count != 0
			          AND a.game_code = '01'
			    ) AS A
			) AS C
			WHERE team_code = '60'
			UNION ALL
			SELECT *
			FROM (
			    SELECT *, ROW_NUMBER() OVER (ORDER BY A.category_data DESC) AS rn
			    FROM (
			        SELECT a.*,a.b_s as category_data,'블록' as cate
			        FROM KCC_EGIS.kbl_data.team_sum a
			        WHERE a.quarter_gu = 'XX'
			          AND a.season_code = #{season_code}
			          AND a.game_count != 0
			          AND a.game_code = '01'
			    ) AS A
			) AS C
			WHERE team_code = '60'
	</select>
<select id="seasonList" resultType="map">
		select  season_code
       		  ,game_code 
       		  ,team_code 
       		  ,quarter_gu 
       		  ,game_count 
       		  ,play_min 
       		  ,play_sec 
       		  ,fg 
       		  ,fg_a 
       		  ,ROUND((convert(float,fg)/nullif(convert(float,fg_a), 0) * 100), 1) AS fgp
       		  ,ft 
       		  ,ft_a 
       		  ,ROUND((convert(float,ft)/nullif(convert(float,ft_a), 0) * 100), 1) AS ftp
       		  ,threep 
       		  ,threep_a 
       		  ,ROUND((convert(float,threep)/nullif(convert(float,threep_a), 0) * 100), 1) AS threepp
       		  ,dk
       		  ,dk_a 
       		  ,pp
       		  ,pp_a
       		  ,ROUND((convert(float,pp)/nullif(convert(float,pp_a), 0)), 1) AS ppp
       		  ,o_r 
       		  ,d_r 
       		  ,(o_r + d_r) r_tot
       		  ,t_r 
       		  ,a_s 
       		  ,s_t 
       		  ,b_s 
       		  ,gd
       		  ,tto
       		  ,t_o 
       		  ,wft 
       		  ,woft 
       		  ,idf
       		  ,tf 
       		  ,bf 
       		  ,ef 
       		  ,foul_tot 
       		  ,tfb 
       		  ,fb 
       		  ,p_score 
       		  ,score AS pts
       from KCC_EGIS.kbl_data.team_sum 
       where quarter_gu ='XX'
       and game_code = '01'
       and team_code = '60'
       order by season_code desc
	</select>
<select id="seasonAvgList" resultType="map">
		select  season_code
       		  ,game_code 
       		  ,team_code 
       		  ,quarter_gu 
       		  ,game_count 
       		  ,play_min 
       		  ,play_sec
       		  ,ROUND((convert(float,fg)/nullif(convert(float,game_count), 0)), 1) AS fg
       		  ,ROUND((convert(float,fg_a)/nullif(convert(float,game_count), 0)), 1) AS fg_a
       		  ,ROUND((convert(float,fg)/nullif(convert(float,fg_a), 0) * 100), 1) AS fgp
       		  ,ROUND((convert(float,ft)/nullif(convert(float,game_count), 0)), 1) AS ft
       		  ,ROUND((convert(float,ft_a)/nullif(convert(float,game_count), 0)), 1) AS ft_a
       		  ,ROUND((convert(float,ft)/nullif(convert(float,ft_a), 0) * 100), 1) AS ftp
       		  ,ROUND((convert(float,threep)/nullif(convert(float,game_count), 0)), 1) AS threep
       		  ,ROUND((convert(float,threep_a)/nullif(convert(float,game_count), 0)), 1) AS threep_a
       		  ,ROUND((convert(float,threep)/nullif(convert(float,threep_a), 0) * 100), 1) AS threepp
       		  ,ROUND((convert(float,pp)/nullif(convert(float,game_count), 0)), 1) AS pp
       		  ,ROUND((convert(float,pp_a)/nullif(convert(float,game_count), 0)), 1) AS pp_a
       		  ,ROUND((convert(float,pp)/nullif(convert(float,pp_a), 0) * 100), 1) AS ppp
       		  ,ROUND((convert(float,o_r)/nullif(convert(float,game_count), 0)), 1) AS o_r
       		  ,ROUND((convert(float,d_r)/nullif(convert(float,game_count), 0)), 1) AS d_r
       		  ,ROUND((convert(float,o_r + d_r)/nullif(convert(float,game_count), 0)), 1) AS r_tot
       		  ,a_s 
       		  ,s_t 
       		  ,ROUND((convert(float,b_s)/nullif(convert(float,game_count), 0)), 1) AS b_s
       		  ,gd
       		  ,tto
       		  ,ROUND((convert(float,t_o)/nullif(convert(float,game_count), 0)), 1) AS t_o
       		  ,wft 
       		  ,woft 
       		  ,idf
       		  ,tf 
       		  ,bf 
       		  ,ef 
       		  ,ROUND((convert(float,foul_tot)/nullif(convert(float,game_count), 0) * 100), 1) AS foul_tot
       		  ,tfb 
       		  ,fb 
       		  ,p_score 
       		  ,score 
       		  ,ROUND((convert(float,score)/convert(float,game_count)), 1) AS pts
       from KCC_EGIS.kbl_data.team_sum 
       where quarter_gu ='XX'
       and game_code = '01'
       and team_code = '60'
       order by season_code desc
	</select>
</mapper>